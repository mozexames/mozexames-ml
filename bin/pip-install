#!/usr/bin/env bash

set -e

ORANGE='\033[0;33m'
ENDCOLOR='\033[0m'

echo; echo "================================"
echo -e "Using pip version: ${ORANGE}$(pip --version)${ENDCOLOR}"
echo "================================"; echo

# If a dependency is specified, just install that and update the requirements and lock files.
if [ $# -gt 0 ]; then
  echo -e "${ORANGE}* Installing the specified dependency: ${1}${ENDCOLOR}"
  pip install --no-warn-script-location --no-cache-dir "${@}"
  echo;
fi

# Install all dependencies from the requirements.txt file
echo -e "${ORANGE}* Installing dependencies from requirements.txt${ENDCOLOR}"
pip install --no-warn-script-location --no-cache-dir -r requirements.txt -c requirements-lock.txt

# Detect changes in the requirements.txt file and update the lock file accordingly.
echo; echo -e "${ORANGE}* Writing lock file${ENDCOLOR}"
pip freeze > requirements.txt
pip freeze > requirements-lock.txt
echo "Lock file updated."
